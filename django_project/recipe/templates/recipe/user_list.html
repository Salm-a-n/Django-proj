{% extends 'layout/base.html' %}
{% block title %}Users{% endblock %}
{% block content %}

<style>
  .status-btn {
    width: 90px;
  }
</style>

<h2 class="mb-4 text-center">User List</h2>
<form method="get" class="mb-3 d-flex justify-content-center">

  <input
    type="text"
    name="q"
    value="{{ search_query }}"
    class="form-control w-50 me-2"
    placeholder="Search by chef name"
  >

  <button type="submit" class="btn btn-primary me-2">
    Search
  </button>

  {% if search_query %}
    <a href="{% url 'users_list' %}" class="btn btn-outline-secondary">
      Clear
    </a>
  {% endif %}

</form>


<div class="card shadow">
  <div class="card-body p-0">
    <table class="table table-hover table-bordered mb-0 align-middle">
      <thead class="table-dark text-center">
        <tr>
          <th>ID</th>
          <th>Chef</th>
          <th>View</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>

        {% for user in users %}
        <tr class="text-center">
          <td>{{ user.id }}</td>
          <td>{{ user.name }}</td>

          <td>
            <a href="{% url 'user_recipes' user.id %}"
               class="btn btn-sm btn-primary">
              View Recipes
            </a>
          </td>

          <td>
            {% if user.is_active %}
              <a href="{% url 'toggle_user' user.id %}"
                 class="btn btn-sm btn-warning status-btn">
                 Block
              </a>
            {% else %}
              <a href="{% url 'toggle_user' user.id %}"
                 class="btn btn-sm btn-success status-btn">
                 Unblock
              </a>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="text-center text-muted py-4">
            No users found
          </td>
        </tr>
        {% endfor %}

      </tbody>
    </table>
  </div>
</div>

{% if users.paginator.num_pages > 1 %}
<nav class="mt-3">
  <ul class="pagination justify-content-center">

    {% if users.has_previous %}
      <li class="page-item">
        <a class="page-link"
           href="?page={{ users.previous_page_number }}&q={{ search_query }}">
          Previous
        </a>
      </li>
    {% endif %}

    {% for num in users.paginator.page_range %}
      {% if users.number == num %}
        <li class="page-item active">
          <span class="page-link">{{ num }}</span>
        </li>
      {% else %}
        <li class="page-item">
          <a class="page-link"
             href="?page={{ num }}&q={{ search_query }}">
            {{ num }}
          </a>
        </li>
      {% endif %}
    {% endfor %}

    {% if users.has_next %}
      <li class="page-item">
        <a class="page-link"
           href="?page={{ users.next_page_number }}&q={{ search_query }}">
          Next
        </a>
      </li>
    {% endif %}

  </ul>
</nav>
{% endif %}

{% endblock %}
